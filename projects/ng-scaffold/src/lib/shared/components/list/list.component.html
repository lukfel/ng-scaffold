<!-- lf-list.component.html -->
<div class="lf-table">
  <!-- Header -->
  @if (header) {
    <div class="lf-table-item lf-table-item-header">
      <!-- avatar -->
      @if (header.avatar) {
        <div class="lf-table-item-avatar px-2">
          <img [src]="header.avatar" alt="Avatar of header" (error)="onImageError($event)" />
        </div>
      } @else if (header.matIcon || header.svgIcon) {
        <div class="lf-table-item-avatar px-2">
          <lf-icon [matIcon]="header.matIcon" [svgIcon]="header.svgIcon"></lf-icon>
        </div>
      } @else if (hasAvatars) {
        <div class="lf-table-item-avatar px-2"></div>
      }

      <!-- title -->
      <div class="lf-table-item-title-wrapper flex-row px-2">
        @for (item of header.items; track $index) {
          <span [class.clickable]="item.sortToken" (click)="updateSortToken(item.sortToken)">
            {{ item.title }}
            @if (sortToken === item.sortToken) {
              <mat-icon class="lf-table-item-sort-icon">
                {{ sortAsc ? "arrow_downward" : "arrow_upward" }}
              </mat-icon>
            }
          </span>
        }
      </div>

      <!-- buttons -->
      <div class="lf-table-item-buttons"></div>

      <!-- checkbox -->
      @if (header.enableSelection) {
        <div class="lf-table-item-checkbox ml-3">
          <mat-checkbox
            [(ngModel)]="allSelected"
            [indeterminate]="someSelected"
            (change)="selectAll($event)"></mat-checkbox>
        </div>
      }
    </div>
    <mat-divider></mat-divider>
  }

  <!-- Items -->
  @for (item of items; track item.id; let last = $last) {
    <div
      class="lf-table-item lf-table-item-data"
      [class.active]="item.checked"
      [class.disabled]="item.disabled"
      [class.clickable]="item.clickable && !item.disabled"
      [ngClass]="item.cssClass">
      <!-- avatar -->
      @if (item.avatar) {
        <div class="lf-table-item-avatar px-2">
          <img
            [src]="item.avatar"
            [alt]="'Avatar of ' + item.title"
            (error)="onImageError($event)" />
        </div>
      } @else if (item.matIcon || item.svgIcon) {
        <div class="lf-table-item-avatar px-2">
          <lf-icon [matIcon]="item.matIcon" [svgIcon]="item.svgIcon"></lf-icon>
        </div>
      }

      <!-- title -->
      <div class="lf-table-item-title-wrapper px-2">
        <span
          class="lf-table-item-title"
          (click)="item.clickable && !item.disabled ? itemClickEvent.emit(item) : null">
          {{ item.title }}
        </span>
        @if (item.subtitle || subtitleTemplate) {
          <span class="lf-table-item-subtitle">
            @if (subtitleTemplate) {
              <ng-container
                [ngTemplateOutlet]="subtitleTemplate"
                [ngTemplateOutletContext]="{ $implicit: item }"></ng-container>
            } @else {
              {{ item.subtitle }}
            }
          </span>
        }
      </div>

      <!-- buttons -->
      <div class="lf-table-item-buttons">
        @let combinedButtons = getCombinedActions(item);
        @for (button of combinedButtons; track button.id) {
          @if (!item.hiddenButtonIds?.includes(button.id)) {
            @let disabled =
              button.disabled || item.disabled || item.disabledButtonIds?.includes(button.id);
            @if (button.label) {
              <button
                mat-button
                class="lf-bottom-bar-button ml-2"
                [class.disabled]="disabled"
                [ngClass]="button.cssClass"
                (click)="buttonClickEvent.emit({ buttonId: button.id, item })"
                [disabled]="disabled"
                [matTooltip]="button.tooltip">
                @if (button.matIcon || button.svgIcon) {
                  <lf-icon
                    [matIcon]="button.matIcon"
                    [svgIcon]="button.svgIcon"
                    verticalAlign="bottom"></lf-icon>
                }
                {{ button.label }}
              </button>
            } @else {
              <button
                mat-icon-button
                class="lf-bottom-bar-button-icon ml-2"
                [class.disabled]="disabled"
                [ngClass]="button.cssClass"
                (click)="buttonClickEvent.emit({ buttonId: button.id, item })"
                [disabled]="disabled"
                [matTooltip]="button.tooltip">
                <lf-icon [matIcon]="button.matIcon" [svgIcon]="button.svgIcon"></lf-icon>
              </button>
            }
            <!-- [color]="button.color" -->
          }
        }
      </div>

      <!-- checkbox -->
      @if (header?.enableSelection) {
        <div class="lf-table-item-checkbox ml-3">
          <mat-checkbox
            [(ngModel)]="item.checked"
            (change)="selectItem(item, $event)"
            [disabled]="item.disabled!"></mat-checkbox>
        </div>
      }
    </div>
    @if (showDividers && !last) {
      <mat-divider></mat-divider>
    }
  }
</div>
